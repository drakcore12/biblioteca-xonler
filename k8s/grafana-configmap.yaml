apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-datasources
  namespace: biblioteca-xonler
data:
  prometheus.yml: |
    apiVersion: 1

    datasources:
      - name: Prometheus
        type: prometheus
        access: proxy
        url: http://prometheus-service:9090
        isDefault: true
        editable: true
        jsonData:
          timeInterval: "15s"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: biblioteca-xonler
data:
  dashboard.yml: |
    apiVersion: 1

    providers:
      - name: 'Default'
        orgId: 1
        folder: ''
        type: file
        disableDeletion: false
        updateIntervalSeconds: 10
        allowUiUpdates: true
        options:
          path: /etc/grafana/provisioning/dashboards
  nodejs-dashboard.json: |
    {       "uid": "nodejs-app-metrics",       "title": "Node.js Application Metrics",       "tags": [         "nodejs",         "application"       ],       "timezone": "browser",       "schemaVersion": 27,       "version": 1,       "refresh": "10s",       "panels": [         {           "id": 1,           "title": "HTTP Requests Rate",           "type": "stat",           "gridPos": {             "h": 4,             "w": 6,             "x": 0,             "y": 0           },           "targets": [             {               "expr": "rate(http_requests_total[5m])",               "refId": "A",               "legendFormat": "{{method}} {{route}}"             }           ],           "fieldConfig": {             "defaults": {               "unit": "reqps",               "decimals": 2             }           }         },         {           "id": 2,           "title": "HTTP Request Duration (p95)",           "type": "stat",           "gridPos": {             "h": 4,             "w": 6,             "x": 6,             "y": 0           },           "targets": [             {               "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",               "refId": "A"             }           ],           "fieldConfig": {             "defaults": {               "unit": "s",               "decimals": 3             }           }         },         {           "id": 3,           "title": "HTTP Status Codes",           "type": "stat",           "gridPos": {             "h": 4,             "w": 6,             "x": 12,             "y": 0           },           "targets": [             {               "expr": "sum(rate(http_requests_total[5m])) by (status)",               "refId": "A",               "legendFormat": "{{status}}"             }           ],           "fieldConfig": {             "defaults": {               "unit": "reqps",               "decimals": 2             }           }         },         {           "id": 4,           "title": "Active Connections",           "type": "stat",           "gridPos": {             "h": 4,             "w": 6,             "x": 18,             "y": 0           },           "targets": [             {               "expr": "active_connections",               "refId": "A"             }           ],           "fieldConfig": {             "defaults": {               "unit": "short",               "decimals": 0             }           }         },         {           "id": 5,           "title": "HTTP Requests Over Time",           "type": "timeseries",           "gridPos": {             "h": 8,             "w": 12,             "x": 0,             "y": 4           },           "targets": [             {               "expr": "rate(http_requests_total[5m])",               "refId": "A",               "legendFormat": "{{method}} {{route}} {{status}}"             }           ],           "fieldConfig": {             "defaults": {               "unit": "reqps",               "decimals": 2             }           }         },         {           "id": 6,           "title": "HTTP Request Duration",           "type": "timeseries",           "gridPos": {             "h": 8,             "w": 12,             "x": 12,             "y": 4           },           "targets": [             {               "expr": "histogram_quantile(0.50, rate(http_request_duration_seconds_bucket[5m]))",               "refId": "A",               "legendFormat": "p50"             },             {               "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",               "refId": "B",               "legendFormat": "p95"             },             {               "expr": "histogram_quantile(0.99, rate(http_request_duration_seconds_bucket[5m]))",               "refId": "C",               "legendFormat": "p99"             }           ],           "fieldConfig": {             "defaults": {               "unit": "s",               "decimals": 3             }           }         },         {           "id": 7,           "title": "Database Queries Rate",           "type": "timeseries",           "gridPos": {             "h": 8,             "w": 12,             "x": 0,             "y": 12           },           "targets": [             {               "expr": "rate(db_queries_total[5m])",               "refId": "A",               "legendFormat": "{{query_type}} {{table}}"             }           ],           "fieldConfig": {             "defaults": {               "unit": "reqps",               "decimals": 2             }           }         },         {           "id": 8,           "title": "Database Query Duration",           "type": "timeseries",           "gridPos": {             "h": 8,             "w": 12,             "x": 12,             "y": 12           },           "targets": [             {               "expr": "histogram_quantile(0.95, rate(db_query_duration_seconds_bucket[5m]))",               "refId": "A",               "legendFormat": "p95"             }           ],           "fieldConfig": {             "defaults": {               "unit": "s",               "decimals": 3             }           }         },         {           "id": 9,           "title": "CPU Usage",           "type": "timeseries",           "gridPos": {             "h": 8,             "w": 12,             "x": 0,             "y": 20           },           "targets": [             {               "expr": "rate(process_cpu_user_seconds_total[5m]) * 100",               "refId": "A",               "legendFormat": "CPU %"             }           ],           "fieldConfig": {             "defaults": {               "unit": "percent",               "decimals": 2             }           }         },         {           "id": 10,           "title": "Memory Usage",           "type": "timeseries",           "gridPos": {             "h": 8,             "w": 12,             "x": 12,             "y": 20           },           "targets": [             {               "expr": "process_resident_memory_bytes",               "refId": "A",               "legendFormat": "Memory"             }           ],           "fieldConfig": {             "defaults": {               "unit": "bytes",               "decimals": 2             }           }         }       ],       "time": {         "from": "now-15m",         "to": "now"       },       "timepicker": {},       "templating": {         "list": []       },       "annotations": {         "list": []       }     }     